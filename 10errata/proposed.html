<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
<style type="text/css">
code           { font-family: monospace; }

div.constraint,
div.issue,
div.note,
div.notice     { margin-left: 2em; }

div.quote      { border: solid 1px black;
                 padding: 5px;
               }

li p           { margin-top: 0.3em;
                 margin-bottom: 0.3em; }

div.exampleInner pre { margin-left: 1em;
                       margin-top: 0em; margin-bottom: 0em}
div.exampleOuter {border: 4px double gray;
                  margin: 0em; padding: 0em}
div.exampleInner { background-color: #d5dee3;
                   border-top-width: 4px;
                   border-top-style: double;
                   border-top-color: #d3d3d3;
                   border-bottom-width: 4px;
                   border-bottom-style: double;
                   border-bottom-color: #d3d3d3;
                   padding: 4px; margin: 0em }
div.exampleWrapper { margin: 4px }
div.exampleHeader { font-weight: bold;
                    margin: 4px}

div.diff-add  { background-color: #FFFF99; }
div.diff-del  { background-color: #FF9999; text-decoration: line-through; }
div.diff-chg  { background-color: #99FF99; }
div.diff-off  {  }

span.diff-add { background-color: #FFFF99; }
span.diff-del { background-color: #FF9999; text-decoration: line-through; }
span.diff-chg { background-color: #99FF99; }
span.diff-off {  }

td.diff-add   { background-color: #FFFF99; }
td.diff-del   { background-color: #FF9999; text-decoration: line-through; }
td.diff-chg   { background-color: #99FF99; }
td.diff-off   {  }

em.rfc2119 { text-transform: lowercase;
             font-variant: small-caps;
             font-style: normal; }
dt.plusmarge { margin-top: 2em; }
</style>
<link rel="stylesheet" type="text/css" href="http://www.w3.org/StyleSheets/TR/base.css" />
<title>Proposed Errata in REC-xproc-20100511</title>
<style type="text/css">
  h3.errata {
  background: #C8C8C8;
  padding: 2ex;
  text-align: center;
  }
  .quote     { font-family: Arial, Helvetica, sans-serif; }
  span.editor { color: red; display: inline }
</style>
</head>
<body>
<div class="head">
<p>
  <a href="http://www.w3.org/">

    <img alt="W3C" src="http://www.w3.org//Icons/w3c_home" height="48" width="72"></img>
  </a>
</p>
<h1>Proposed XProc Specification Errata</h1>
<h2>Abstract</h2>
<p>This document records all known errors in the
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/"><cite>XProc:
An XML Pipeline Language</cite></a>;
for updates see <a href="http://www.w3.org/TR/xproc">the latest version</a>.</p>
<p>The errata are numbered, classified as <a
href="#substantive">Substantive</a> or <a
href="#editorial">Editorial</a>, and listed in <em>reverse
chronological order</em> of their date of publication in each
category. Changes to the text of the spec are indicated thus:

<span class="quote">
<span class="diff-del"><span>deleted text</span></span>, <span
class="diff-add"><span>new text</span></span>, <span
class="diff-chg"><span>modified text</span></span> </span>.
Substantive corrections are proposed by the
<a href="http://www.w3.org/XML/Processing/">XML Processing Model
Working Group</a>, which
has consensus that they are appropriate; they are not to be considered
normative until approved by a <a
href="http://www.w3.org/2004/02/Process-20040205/tr.html#cfr-corrections">Call
for Review of Proposed Corrections</a> or a <a
href="http://www.w3.org/2004/02/Process-20040205/tr.html#cfr-edited">Call
for Review of an Edited Recommendation</a>.</p>

<p>Please email error reports to <a
href="mailto:public-xml-processing-model-comments@w3.org"
>public-xml-processing-model-comments@w3.org</a>.
</p>

</div>
<hr align="left" width="50%" />
<h2 id="substantive">Substantive errata</h2>

<div class="erratum" id="s-04">
  <h3>S04, 12 March 2014</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.choose">4.4 p:choose</a>
    </dt>
    <dd><p>To address bug
<a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=21006">21006</a>,
make the following changes.</p>

<p>Change the first paragraph after the syntax box as follows:</p>

<div class="quote">
<p>A p:choose has no inputs. It contains an arbitrary number of
alternative
<span class="diff-del">subpipelines</span><span class="diff-add">branches
(identified with p:when and p:otherwise elements)</span>,
exactly one of which will be evaluated.</p>
</div>

<p>Change the fourth paragraph after the syntax box as follows:</p>

<div class="quote">
<p>After a
<span class="diff-del">subpipeline</span><span class="diff-add">branch</span>
is selected, it is evaluated as if only
<span class="diff-del">it</span>
<span class="diff-add">its children</span>
had been present.
</p>
</div>
    </dd>
  </dl>
</div>

<div class="erratum" id="s-03">
  <h3>S03, 12 March 2014</h3>
  <dl>
    <dt class="plusmarge">Sections
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.choose">4.4 p:choose</a>
and
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.xpath-context">4.4.1 p:xpath-context</a>
    </dt>
    <dd><p>To address bug
<a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=21003">21003</a>,
make the following changes.</p>

<p>Change the penultimate paragraph of 4.4 as follows:</p>

<div class="quote">
<p>The p:choose can specify the context node against which the XPath
expressions that occur on each branch are evaluated. The context node
is specified as a connection in the p:xpath-context. If no
<span class="diff-del">explicit
connection</span><span class="diff-add">p:xpath-context</span>
is provided, the default readable port is used. In an XPath
1.0 implementation, if the context node is connected to p:empty, or is
unconnected and the default readable port is undefined, an empty
document node is used instead as the context. In an XPath 2.0
implementation, the context item is undefined.
</p>
</div>

<p>And delete the last paragraph of 4.4.1:</p>
<div class="quote">
<p><span class="diff-del">In an XPath 1.0 implementation, if the context
node is connected to p:empty, or is unconnected and the default
readable port is undefined, an empty document node is used instead as
the context. In an XPath 2.0 implementation, the context item is
undefined.</span></p>
</div>
    </dd>
  </dl>
</div>

<div class="erratum" id="s-02">
  <h3>S02, 12 March 2014</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.option">5.7.2 p:option</a>
    </dt>
    <dd><p>To address bug
<a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=21002">21002</a>, change the fourth paragraph (the first paragraph after
the first syntax box) as follows:</p>
<div class="quote">
<p>An option may be declared as required. If an option is required,
<span class="diff-add">it
  is an error to invoke that step without specifying a value for that
  option. For steps invoked within a pipeline,</span>
it
is a static error (err:XS0018) to <span class="diff-del">invoke the step</span>
<span class="diff-add">specify an invocation</span> without
<span class="diff-chg">providing</span> a
value for <span class="diff-del">that</span><span class="diff-add">a
required</span> option.
<span class="diff-add">For pipelines invoked directly by an external
  environment (informally, top-level pipelines), this error cannot be
  detected statically. It is a dymamic error (err:XD????) to invoke
  a pipeline without specifying a value for a required option.</span>
</p>
</div>
<p>We leave it to the discretion of the editor to define the new dynamic
error number.</p>
    </dd>
  </dl>
</div>

<div class="erratum" id="s-01">
  <h3>S01, 12 March 2014</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#xpath-context">2.6 XPaths in XProc</a></dt>
    <dd><p>To address bug
<a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=20995">20995</a>,
add the following errata text somewhere in 2.6:</p>
<div class="quote">
<p>XProc 1.0 fails to adequately address the XPath requirement that
the document-uri property of a document must be a stable identifier. Informally,
if two nodes have the same document-uri, they must be the same document.
The Working Group concludes that attempting to address this in the 1.0
specification is infeasible. It plans to address this issue explicitly
in 2.0.</p>
<p>In the meantime, implementors are encouraged to satisfy the XPath
constraint as much as is practical. The XProc 1.0 specification fails to
mention the document-uri property, so there's no explicit text that
forbids an implementor from satisfying it.</p>
</div>
    </dd>
  </dl>
</div>

<hr align="left" width="50%" />
<h2 id="editorial">Editorial errata</h2>

<div class="erratum" id="e-12">
  <h3>E15, 6 October 2014</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.declare-step">5.8 p:declare-step</a></dt>
    <dd><p>To address bug
<a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=21007">21007</a>,
make the following changes to the paragraph below the first syntax box:</p>
<div class="quote">
<p>The value of the type can be from any namespace provided that the
expanded-QName of the value has a non-null namespace URI<span class="diff-del">. It is a
static error (err:XS0025) if the expanded-QName value of the type
attribute is in no namespace or in the XProc namespace</span>
<span class="diff-add">that
is not the XProc namespace.</span>. Except as
described in Section 2.13, “Versioning Considerations”, the XProc
namespace must not be used in the type of steps. Neither users nor
implementers may define additional steps in the XProc namespace.
</p>
</div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-12">
  <h3>E14, 6 October 2014</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#xproc-xpath-context-10">2.6.1.1 Processor XPath Context</a></dt>
    <dd><p>To address 
<a href="http://www.w3.org/XML/XProc/2013/04/24-minutes#action06">action A-230-05</a>,
make the following changes to the note under “variable bindings”:</p>
<div class="quote">
<p>An option that has neither a specified value nor a default value
will not appear as an in-scope <span class="diff-add">XPath </span>variable.
Consequently, an attempt to refer to <span class="diff-del">that variable</span>
<span class="diff-add">an XPath variable whose name is the name of such
an option</span> will raise an error.</p>
</div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-12">
  <h3>E13, 6 October 2014</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#scoping">3.2 Scoping of Names</a></dt>
    <dd><p>To address 
<a href="http://lists.w3.org/Archives/Public/public-xml-processing-model-wg/2014Oct/0003.html">action A-227-01</a>,
make the following changes to the penultimate paragraph of the section:</p>
<div class="quote">
<p>The scope of option and variable names is determined by where they
are declared. When an option is declared with p:option (or a variable
with p:variable), unless otherwise specified, its scope consists of
the sibling elements that follow its declaration and the descendants
of those siblings. It is a static error (err:XS0004) if an option or
variable declaration duplicates the name of any other option or
variable <span class="diff-del">in the same environment. That is, no option or variable may
lexically shadow another option or variable with the same name</span>
<span class="diff-add">among its preceding siblings</span>.</p>
</div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-12">
  <h3>E12, 12 March 2014</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.variable">5.7.1 p:variable</a></dt>
    <dd><p>To address bug
<a href="https://www.w3.org/Bugs/Public/show_bug.cgi?id=21004">21004</a>,
make the following changes to the four paragraphs which follow the syntax
box:</p>
<div class="quote">
<p><span class="diff-del">If a select expression is given,
it</span><span class="diff-add">The select expression</span>
is evaluated as an XPath
expression using the appropriate context as described in Section 2.6,
“XPaths in XProc”, for the enclosing container, with the addition of
bindings for all preceding-sibling p:variable and p:option elements.
Regardless of the implicit type of the expression, when XPath 1.0 is
being used, the string value of the expression becomes the value of
the variable; when XPath 2.0 is being used, the type is treated as an
xs:untypedAtomic.</p>

<p>Since all in-scope bindings are present in the Processor XPath
Context as variable bindings, select expressions may refer to the
value of in-scope bindings by variable reference. If a variable
reference uses a QName that is not the name of an in-scope binding, an
XPath evaluation error will occur.</p>

<p><span class="diff-del">If a select expression is given,
the</span><span class="diff-add">The</span>
readable ports available for
document connections are the readable ports in the environment
inherited by the first step in the surrounding container's contained
steps. However, in order to avoid ordering paradoxes, it is a static
error (err:XS0019) for a variable's document connection to refer to
the output port of any step in the surrounding container's contained
steps.</p>

<p><span class="diff-del">If a select expression is given
but</span><span class="diff-add">If</span>
no document connection is
provided, the implicit connection is to the default readable port in
the environment inherited by the first step in the surrounding
container's contained steps. If there is no default readable port, the
connection is treated as if p:empty was specified.</p>
</div>
    </dd>

  </dl>
</div>

<div class="erratum" id="e-11">
  <h3>E11, 01 February 2012</h3>
  <dl>
    <dt class="plusmarge">Globally</dt>
    <dd><p>Move the conformance phrases into the conformance appendix.</p></dd>
  </dl>
</div>

<div class="erratum" id="e-10">
  <h3>E10, 21 July 2011</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.try">4.6 p:try</a></dt>
    <dd><p>In the context of a <code>p:catch</code>, the <code>error</code> port is an input port
not an output port; remove the word output.</p>
    <div class="quote">
<p>What appears on the error <span class="diff-del">output</span> port is an error document. The error
document may contain messages generated by steps that were part of the
initial subpipeline. Not all messages that appear are indicative of
errors; for example, it is common for all xsl:message output from the
XSLT component to appear on the error <span class="diff-del">output</span> port. It is possible that
the component which fails may not produce any messages at all. It is
also possible that the failure of one component may cause others to
fail so that there may be multiple failure messages in the document.</p>
    </div>
    </dd>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#err-vocab">4.6.1 The Error Vocabulary</a></dt>
<dd>
  <p>Also here:</p>
    <div class="quote">
<p>The p:try/p:catch mechanism gives pipeline authors the opportunity
to process the errors that caused the p:try to fail. In order to
facilitate some modicum of interoperability among processors, errors
that are reported on the error <span class="diff-del">output</span> port of a p:catch should conform
to the format described here.
</p>
    </div>
</dd>
  </dl>
</div>

<div class="erratum" id="e-09">
  <h3>E09, 3 February 2011</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#example-http-request">7.1.10.5 HTTP Request Example</a></dt>
    <dd><p>Make request/response consistent with respect to the “detailed” setting.</p>
    <div class="quote">
<pre>&lt;c:request xmlns:c="http://www.w3.org/ns/xproc-step"
           method="POST" href="http://www.example.com/form-action" <span class="diff-add">
           detailed="true"></span>
&lt;c:body content-type="application/x-www-form-urlencoded">
name=W3C&amp;spec=XProc
&lt;/c:body>
&lt;/c:request></pre>
    </div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-08">
  <h3>E08, 2 February 2011</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#namespaces">3.1 XProc Namespaces</a></dt>
    <dd><p>Add text to discourage implementors from creating errors in the <code>xproc-error</code>
namespace.</p>
    <div class="quote">
<dl>
<dt><code>http://www.w3.org/ns/xproc-error</code></dt>
<dd><p>The namespace used for errors. The conventional prefix
“<code>err:</code>” is used for this namespace.</p>
<p><span class="diff-add">Implementors are discouraged from inventing new error codes in the
XProc error namespace; they are reserved for future versions of this specification or other
working group products.</span></p></dd>
</dl>
    </div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-07">
  <h3>E07, 2 February 2011</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#input-output">2 Pipeline Concepts</a></dt>
    <dd><p>Clarify that the output of a compound step may be connected to any readable port, as specified
in <a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#input-output">2.2 Inputs and Outputs</a></p>

    <div class="quote">
Within a compound step, the <em>declared outputs</em> of the step can be connected to:
<ul>
<li><span class="diff-add">Any one of the compound step's readable ports.</span></li>
<li>The output port of some contained step.</li>
<li>A fixed, inline document or sequence of documents.</li>
<li>A document read from a URI.</li>
</ul>
    </div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-06">
  <h3>E06, 2 February 2011</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#pipeline-concepts">2 Pipeline Concepts</a></dt>
    <dd><p>Add definitions for pipeline processor and implementation.</p>
    <div class="quote">
<div>The result of evaluating a pipeline (or subpipeline) is the result of
evaluating the steps that it contains, in an order consistent with the
connections between them. A pipeline must behave as if it evaluated
each step each time it is encountered.</div>
<br/>
<div class="diff-add">[Definition: The software responsible for evaluating XProc pipelines is
referred to as an <em>XProc Processor</em>. In contexts where the kind of processor
is unambiguous, it is sometimes referred to simple as “the processor”.]</div>
<br/>
<div class="diff-add">[Definition: A specific product that performs the functions of an XProc
processor is referred to as an <em>implementation</em>.]</div>
<br/>
<div>Unless otherwise indicated,
implementations must not assume that steps are functional (that is,
that their outputs depend only on their inputs, options, and
parameters) or side-effect free.</div>
    </div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-05">
  <h3>E05, 2 February 2011</h3>
  <dl>
    <dt class="plusmarge">Section <a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.xpath-context">4.4.1 p:xpath-context</a></dt>
    <dd><p>Make it clear that <code>err:XD0026</code> applies in this case too.</p>
    <div class="quote">
…In an XPath 2.0 implementation, the context item is undefined.
<span class="diff-add">It is a
dynamic error (err:XD0026) if the select expression makes reference to
the context node, size, or position when the context item is undefined.</span>
    </div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-04">
  <h3>E04, 2 February 2011</h3>
  <dl>
    <dt class="plusmarge">Section
<a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.choose">4.4 p:choose</a></dt>
    <dd><p>Make it clear that <code>err:XD0026</code> applies in this case too.</p>
    <div class="quote">
…In an XPath 2.0 implementation, the context item is undefined.
<span class="diff-add">It is a
dynamic error (err:XD0026) if the select expression makes reference to
the context node, size, or position when the context item is undefined.</span>
    </div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-03">
  <h3>E03, 2 February 2011</h3>
  <dl>
    <dt class="plusmarge">Section <a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#p.document">5.13 p:document</a></dt>
    <dd><p>Make it clear that support for <code>xml:id</code> is <em>implementation-defined</em>.
Add a new paragraph after the paragraph that begins “The parser which the…”:</p>
    <div class="quote">
<span class="diff-add">Support for <code>xml:id</code> in XProc processors is <em>implementation-defined</em>. Implementors
are encouraged to support <code>xml:id</code> wherever practical.</span></div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-02">
  <h3>E02, 22 June 2010</h3>
  <dl>
    <dt class="plusmarge">Section <a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#c.request_response">7.1.10.3 Managing the Response</a></dt>
    <dd><p>Make it clear that “decoded if necessary” in bullet 1 of the last bulleted list
applies to the content encoding
by changing the text of the bullet as follows:</p>
    <div class="quote">
If the media type (as determined by the <code>override-content-type</code>
attribute or the <code>Content-Type</code> response header) is an XML media type,
the entity is decoded if necessary
<span class="diff-add"> (if a <code>Content-Encoding</code> response header is present and
specifies
an encoding other than <code>identity</code>)</span>,
then parsed as an XML document and
produced on the result output port as the entire output of the step.</div>
    </dd>
  </dl>
</div>

<div class="erratum" id="e-01">
  <h3>E01, 22 June 2010</h3>
  <dl>
    <dt class="plusmarge">Section <a href="http://www.w3.org/TR/2010/REC-xproc-20100511/#c.response_body">7.1.10.4 Converting Response Entity Bodies</a></dt>
    <dd><p>Make it clear that the final note only applies when no charset is specified
by changing the text of the note as follows:</p>
    <div class="quote">
      Given the above description, any content identified as text/html
      <span class="diff-add">without specifying a Unicode character encoding</span>
      will be encoded as (escaped) text or base64-encoded in the
      c:body element, as HTML isn't always well-formed XML. A user can
      attempt to convert such content into XML using the
      p:unescape-markup step.
    </div>
    </dd>
  </dl>
</div>

</body>
</html>
